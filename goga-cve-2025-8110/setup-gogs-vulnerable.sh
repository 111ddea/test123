#!/bin/bash

# ========================================
# Gogs 0.13.2 Docker Setup (VULNERABLE)
# CVE-2025-8110 Educational Environment
# ========================================
# 
# WARNING: This version contains a critical RCE vulnerability
# Only use in isolated local environment for learning purposes
# Do NOT expose to the internet or production networks
#

set -e

echo "=================================="
echo "Setting up Gogs 0.13.2 (VULNERABLE)"
echo "=================================="
echo ""
echo "⚠️  WARNING: This version is vulnerable to CVE-2025-8110"
echo "   - Use ONLY for local security research"
echo "   - Do NOT expose to the internet"
echo "   - Delete after learning session"
echo ""

# Create directory structure
mkdir -p gogs-data
cd gogs-data

# Pull the specific vulnerable version
echo "[+] Pulling Gogs 0.13.2 Docker image..."
docker pull gogs/gogs:0.13.2

# Run Gogs container with isolated network
echo "[+] Starting Gogs container..."
docker run -d \
  --name gogs-vulnerable \
  -p 127.0.0.1:3000:3000 \
  -p 127.0.0.1:10022:22 \
  -v $(pwd)/gogs-data:/data \
  gogs/gogs:0.13.2

echo ""
echo "✅ Gogs 0.13.2 is now running!"
echo ""
echo "Access URL: http://localhost:3000"
echo ""
echo "Next steps:"
echo "1. Open http://localhost:3000 in your browser"
echo "2. Complete the initial setup wizard"
echo "3. Create an admin account"
echo ""
echo "To stop and remove:"
echo "  docker stop gogs-vulnerable"
echo "  docker rm gogs-vulnerable"
echo ""
echo "To completely cleanup:"
echo "  docker rmi gogs/gogs:0.13.2"
echo "  rm -rf $(pwd)/gogs-data"
echo ""
